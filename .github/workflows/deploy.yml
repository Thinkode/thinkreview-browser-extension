name: Deploy to Chrome Web Store

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: true
        default: 'staging'
        type: choice
        options:
        - staging
        - production

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: ${{ github.event.inputs.environment }}
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Run full CI pipeline
      run: |
        npm run lint:check
        npm run validate
        npm run build
        
    - name: Create Chrome Web Store package
      run: |
        # Get version from manifest for zip filename
        VERSION=$(node -e "console.log(require('./manifest.json').version)")
        
        cd build
        zip -r ../ThinkReview_${VERSION}.zip .
        
    - name: Upload to Chrome Web Store (Production)
      if: github.event.inputs.environment == 'production'
      run: |
        echo "üöÄ Ready for Chrome Web Store upload"
        echo "üì¶ Package: ThinkReview_${VERSION}.zip"
        echo "‚ö†Ô∏è  Manual upload required to Chrome Web Store Developer Dashboard"
        
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: chrome-extension-${{ github.event.inputs.environment }}
        path: ThinkReview_*.zip
        retention-days: 30
